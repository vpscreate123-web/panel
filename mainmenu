#!/usr/bin/env bash
export LC_ALL=C.UTF-8
export LANG=C.UTF-8

set -u

# ---- COLORS ----
C=$'\033[36m'
G=$'\033[32m'
R=$'\033[31m'
B=$'\033[34m'
Y=$'\033[33m'
W=$'\033[97m'
P=$'\033[35m'
BLINK=$'\033[5m'
N=$'\033[0m'

# ---- TYPEWRITER EFFECT ----
typewriter() {
    text="$1"
    delay=0.005
    for ((i=0; i<${#text}; i++)); do
        printf "%s" "${text:$i:1}"
        sleep $delay
    done
    printf "\n"
}

# ---- PROGRESS BAR ----
progress_bar() {
    echo -e "${C}Initializing TYRKROX NODE...${N}"
    for i in {1..30}; do
        printf "${G}#${N}"
        sleep 0.03
    done
    echo ""
    for i in {0..100..10}; do
        printf "\r${Y}Loading System: $i%%%${N}"
        sleep 0.15
    done
    echo ""
    sleep 1
}

# ---- INTRO ----
intro() {
    clear
    echo -e "${P}"
    typewriter "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—"
    typewriter "â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•"
    typewriter "   â–ˆâ–ˆâ•‘    â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ•”â• "
    typewriter "   â–ˆâ–ˆâ•‘     â•šâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— "
    typewriter "   â–ˆâ–ˆâ•‘      â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—"
    typewriter "   â•šâ•â•      â•šâ•â•   â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•"
    echo -e "${N}"
    echo ""
    typewriter "ðŸ’Ž TYRKROX NODE BOOTING..."
    sleep 1
    progress_bar
    clear
}

# ---- HEADER ----
header() {
    echo -e "${P}${BLINK}ðŸ’Ž TYRKROX NODE ðŸ’Ž${N}"
    echo -e "${Y}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${N}"
    echo ""
}

pause() {
    echo ""
    read -p "${W}Press [Enter] to return...${N}" dummy
}

# ---- PTERODACTYL MENU FUNCTION ----
ptero_menu() {
    while true; do
        clear
        echo "========================================="
        echo "   PTERODACTYL CONTROL CENTER v2.1"
        echo "========================================="
        echo ""
        echo "1) Install Panel"
        echo "2) Create User"
        echo "3) Update Panel"
        echo "4) Install SSL"
        echo "5) Uninstall Panel"
        echo "6) Back to Main Menu"
        echo ""
        read -p "Select option: " opt

        case $opt in
            1)
                bash <(curl -fsSL https://raw.githubusercontent.com/nobita329/ptero/main/ptero/panel/pterodactyl/install.sh)
                read -p "Press Enter..."
                ;;
            2)
                cd /var/www/pterodactyl 2>/dev/null && php artisan p:user:make
                read -p "Press Enter..."
                ;;
            3)
                cd /var/www/pterodactyl || { echo "Panel not installed!"; sleep 2; continue; }
                php artisan down
                curl -Lo panel.tar.gz https://github.com/pterodactyl/panel/releases/latest/download/panel.tar.gz
                tar -xzvf panel.tar.gz
                COMPOSER_ALLOW_SUPERUSER=1 composer install --no-dev --optimize-autoloader
                php artisan migrate --seed --force
                php artisan up
                read -p "Press Enter..."
                ;;
            4)
                bash <(curl -fsSL https://raw.githubusercontent.com/nobita329/ptero/main/ptero/panel/pterodactyl/ssl.sh)
                read -p "Press Enter..."
                ;;
            5)
                rm -rf /var/www/pterodactyl
                echo "Panel Removed."
                sleep 2
                ;;
            6)
                break
                ;;
            *)
                echo "Invalid option"
                sleep 1
                ;;
        esac
    done
}

# ---- START ----
intro

# ---- MAIN LOOP ----
while true; do
    clear
    header

    echo -e "${C} 1) ${W}Discord Server Link${N}"
    echo -e "${C} 2) ${W}Proxmox VE (Docker) Install ðŸš€${N}"
    echo -e "${C} 3) ${W}VM/KVM Installer${N}"
    echo -e "${C} 4) ${W}Pterodactyl Panel Installer${N}"
    echo -e "${C} 5) ${W}Wings Installer${N}"
    echo -e "${C} 6) ${W}Blueprint + Addon Installer${N}"
    echo -e "${C} 7) ${W}SFTP Fixer${N}"
    echo -e "${C} 8) ${W}Tailscale VPN Installer${N}"
    echo -e "${R} 9) Exit${N}"

    echo ""
    read -p "${Y}Select an option [1-9]: ${N}" choice

    case $choice in
        1)
            echo -e "${G}https://discord.gg/2rYEHharqA${N}"
            pause
            ;;
        2)
            docker run -itd \
              --name proxmoxve \
              --hostname pve \
              --privileged \
              --cgroupns=host \
              --security-opt apparmor=unconfined \
              --security-opt seccomp=unconfined \
              -v /sys/fs/cgroup:/sys/fs/cgroup:rw \
              -v /lib/modules:/lib/modules:ro \
              -v /dev/fuse:/dev/fuse \
              -v /sys/kernel/debug:/sys/kernel/debug \
              -p 8006:8006 \
              --restart unless-stopped \
              rtedpro/proxmox:9.0.11
            pause
            ;;
        3)
            bash <(curl -fsSL https://raw.githubusercontent.com/vpscreate123-web/mainnemu/main/Mainmenu)
            pause
            ;;
        4)
            ptero_menu
            ;;
        5)
            bash <(curl -fsSL https://raw.githubusercontent.com/nobita329/ptero/main/ptero/wings/install.sh)
            pause
            ;;
        6)
            echo "Blueprint installer coming soon..."
            pause
            ;;
        7)
            systemctl restart ssh
            pause
            ;;
        8)
            curl -fsSL https://tailscale.com/install.sh | sh
            pause
            ;;
        9)
            echo -e "${G}TYRKROX NODE ROCKS ðŸ˜ŽðŸ”¥${N}"
            sleep 1
            exit 0
            ;;
        *)
            echo -e "${R}Invalid Option!${N}"
            sleep 1.5
            ;;
    esac
done
